// ============================================================================
// INQUIRY - Workflow for applications, invitations, requests
// ============================================================================

model Inquiry {
  id        String   @id @default(dbgenerated("uuidv7()")) @db.VarChar(36)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  sentAt    DateTime?

  type   InquiryType
  status InquiryStatus @default(draft)

  content    Json @default("{}")
  resolution Json @default("{}")

  // Source (who creates/sends) - fake polymorphism
  sourceModel          InquiryResourceModel
  sourceUserId         String?       @db.VarChar(36)
  sourceOrganizationId String?       @db.VarChar(36)
  sourceSpaceId        String?       @db.VarChar(36)

  sourceUser         User?         @relation("InquirySource", fields: [sourceUserId], references: [id], onDelete: Cascade)
  sourceOrganization Organization? @relation("InquirySource", fields: [sourceOrganizationId], references: [id], onDelete: Cascade)
  sourceSpace        Space?        @relation("InquirySource", fields: [sourceSpaceId], references: [id], onDelete: Cascade)

  // Target (who receives/resolves) - fake polymorphism
  targetModel          InquiryResourceModel?
  targetUserId         String?       @db.VarChar(36)
  targetOrganizationId String?       @db.VarChar(36)
  targetSpaceId        String?       @db.VarChar(36)

  targetUser         User?         @relation("InquiryTarget", fields: [targetUserId], references: [id], onDelete: Cascade)
  targetOrganization Organization? @relation("InquiryTarget", fields: [targetOrganizationId], references: [id], onDelete: Cascade)
  targetSpace        Space?        @relation("InquiryTarget", fields: [targetSpaceId], references: [id], onDelete: Cascade)

  @@index([sourceModel])
  @@index([sourceUserId])
  @@index([sourceOrganizationId])
  @@index([sourceSpaceId])
  @@index([targetModel])
  @@index([targetUserId])
  @@index([targetOrganizationId])
  @@index([targetSpaceId])
  @@index([type, status])

  // ==========================================================================
  // TEMPLATE ABOVE â€” Add app-specific fields, relations, indexes below
  // ==========================================================================
}

enum InquiryType {
  inviteOrganizationUser
  createSpace
  updateSpace
  transferSpace
}

enum InquiryStatus {
  draft
  sent
  acknowledged
  resolved
  canceled
}

enum InquiryResourceModel {
  admin
  User
  Organization
  Space
}
