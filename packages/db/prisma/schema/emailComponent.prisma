// ============================================================================
// EMAIL COMPONENT
// ============================================================================
// Reusable MJML components for composing email templates.
// Supports polymorphic ownership: default (all tenants), admin (platform), Organization (tenant-branded)

model EmailComponent {
  id        String             @id @default(dbgenerated("uuidv7()")) @db.VarChar(36)
  createdAt DateTime           @default(now())
  updatedAt DateTime           @updatedAt

  slug   String                // "default-header"
  mjml   String               @db.Text // MJML with {{component:slug}} and {{variable.*}} placeholders
  locale String               @default("en")

  // Pre-computed component refs (populated on save)
  componentRefs String[]      // Slugs of nested {{component:slug}} references

  // Owner (false polymorphism - default/admin have no FK)
  ownerModel     EmailOwnerModel @default(default)
  organizationId String?         @db.VarChar(36)
  spaceId        String?         @db.VarChar(36)

  // For org-owned: should spaces inherit this component?
  inheritToSpaces Boolean @default(true)

  organization Organization? @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  space        Space?        @relation(fields: [spaceId], references: [id], onDelete: Cascade)

  @@unique([slug, locale, ownerModel, organizationId, spaceId])
  @@index([ownerModel])
  @@index([organizationId])
}

enum EmailOwnerModel {
  default      // Base resources - read: all, write: super admin
  admin        // Platform internal - super admin only
  Organization // Tenant-branded - org admins
  Space        // Space-specific overrides
}
