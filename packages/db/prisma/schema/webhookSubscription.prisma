// ============================================================================
// WEBHOOK SUBSCRIPTION
// ============================================================================

model WebhookSubscription {
  id        String           @id @default(dbgenerated("uuidv7()")) @db.VarChar(36)
  createdAt DateTime         @default(now())
  updatedAt DateTime         @updatedAt
  model     WebhookModel
  url       String
  isActive  Boolean          @default(true)

  // Owner (fake polymorphism: User, Organization, or Space)
  ownerModel     WebhookOwnerModel
  userId         String?       @db.VarChar(36)
  organizationId String?       @db.VarChar(36)
  spaceId        String?       @db.VarChar(36)

  user         User?         @relation(fields: [userId], references: [id], onDelete: Cascade)
  organization Organization? @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  space        Space?        @relation(fields: [spaceId], references: [id], onDelete: Cascade)

  // Relations
  webhookEvents WebhookEvent[]

  @@unique([userId, model, url])
  @@unique([organizationId, model, url])
  @@unique([spaceId, model, url])
  @@index([ownerModel])
  @@index([model])

  // ==========================================================================
  // TEMPLATE ABOVE â€” Add app-specific fields, relations, indexes below
  // ==========================================================================
}

enum WebhookModel {
  CustomerRef
}

enum WebhookOwnerModel {
  User
  Organization
  Space
}
