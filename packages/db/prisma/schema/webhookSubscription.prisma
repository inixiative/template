// ============================================================================
// WEBHOOK SUBSCRIPTION
// ============================================================================

model WebhookSubscription {
  id        String           @id @default(dbgenerated("uuidv7()")) @db.VarChar(36)
  createdAt DateTime         @default(now())
  updatedAt DateTime         @updatedAt
  model     WebhookModel
  url       String
  secret    String?
  isActive  Boolean          @default(true)

  // Owner (fake polymorphism)
  ownerModel     WebhookOwnerModel
  userId         String?       @db.VarChar(36)
  organizationId String?       @db.VarChar(36)

  user         User?         @relation(fields: [userId], references: [id], onDelete: Cascade)
  organization Organization? @relation(fields: [organizationId], references: [id], onDelete: Cascade)

  // Relations
  events WebhookEvent[]

  @@unique([userId, model, url])
  @@unique([organizationId, model, url])
  @@index([ownerModel])
  @@index([userId])
  @@index([organizationId])
  @@index([model])
}

enum WebhookModel {
  User
  Organization
}

enum WebhookOwnerModel {
  User
  Organization
}
