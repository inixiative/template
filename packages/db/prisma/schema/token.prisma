// ============================================================================
// TOKEN - API keys for user or organization
// ============================================================================

model Token {
  id        String   @id @default(dbgenerated("uuidv7()")) @db.VarChar(36)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  name      String
  keyHash   String   @unique
  keyPrefix String

  // Polymorphic ownership
  ownerModel     TokenOwnerModel
  userId         String?          @db.VarChar(36)
  organizationId String?          @db.VarChar(36)
  spaceId        String?          @db.VarChar(36)

  // Relations
  user             User?             @relation(fields: [userId], references: [id], onDelete: Cascade)
  organization     Organization?     @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  organizationUser OrganizationUser? @relation(fields: [organizationId, userId], references: [organizationId, userId], onDelete: Cascade)
  space            Space?            @relation(fields: [organizationId, spaceId], references: [organizationId, id], onDelete: Cascade)
  spaceUser        SpaceUser?        @relation(fields: [organizationId, spaceId, userId], references: [organizationId, spaceId, userId], onDelete: Cascade)

  // Permissions (for org-owned tokens)
  role         Role @default(member)
  entitlements Json?

  // TODO: Replace with a proper rate limiting system (tiers, quotas, etc.)
  // For now, simple per-second limit. Null = use default (10/s).
  rateLimitPerSecond Int?

  // Lifecycle
  expiresAt  DateTime?
  lastUsedAt DateTime?
  isActive   Boolean   @default(true)

  @@index([userId])
  @@index([organizationId])
  @@index([spaceId])

  // ==========================================================================
  // TEMPLATE ABOVE â€” Add app-specific fields, relations, indexes below
  // ==========================================================================
}

enum TokenOwnerModel {
  User
  Organization
  OrganizationUser
  Space
  SpaceUser
}
